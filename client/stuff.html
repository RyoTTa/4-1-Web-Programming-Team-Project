<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <link href='css/Chat.css' rel='stylesheet' type='text/css'>
    <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
    <!--스크립트 부분. 자신의 스크립트 코드로 변경하세요! -->
    <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
    <script>
        var firebaseEmailAuth; //파이어베이스 email 인증 모듈 전역변수
        var firebaseDatabase; //파이어베이스 db 모듈 전역변수
        var userInfo; //가입한 유저의 정보. object 타입
        //파이어 베이스 초기화 코드
        var config = {
            apiKey: "AIzaSyCweXAFVhwjG8cglNBGgGkelKW4trxFUxM",
            authDomain: "webproject-cc0c8.firebaseapp.com",
            databaseURL: "https://webproject-cc0c8.firebaseio.com",
            projectId: "webproject-cc0c8",
            storageBucket: "webproject-cc0c8.appspot.com",
            messagingSenderId: "1019716028105",
            appId: "1:1019716028105:web:6cb6a7ee21811dc2f66f18",
            measurementId: "G-RF6V6XKLVQ"
        };
        firebase.initializeApp(config);

        firebaseEmailAuth = firebase.auth();
        firebaseDatabase = firebase.database();
        function getUrlParams() {
            var params = {};
            window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (str, key, value) { params[key] = value; });
            return params;
        }
        var oParams = getUrlParams();
        var uName = decodeURI(oParams.myName, "UTF-8");

        var msgsref = firebase.database().ref("msgs/");
        msgsref.on('child_added',function(snapshot){
            var len = uName.length;
            var owner = snapshot.key.substring(0,len);
            var roomName = snapshot.key.substring(len);
            //console.log('방주인은:'+owner);
            //console.log('채팅하고있는사람:'+roomName);
            if(owner == uName){
                console.log(roomName); // 여기 roomName을 방 이름으로 하면 될듯.
            }
        });

    </script>
    <script type="text/javascript">
        $(document).ready(function () {

            var preloadbg = document.createElement("img");
            preloadbg.src = "https://s3-us-west-2.amazonaws.com/s.cdpn.io/245657/timeline1.png";

            $("#searchfield").focus(function () {
                if ($(this).val() == "Search contacts...") {
                    $(this).val("");
                }
            });
            $("#searchfield").focusout(function () {
                if ($(this).val() == "") {
                    $(this).val("Search contacts...");

                }
            });

            $("#sendmessage input").focus(function () {
                if ($(this).val() == "Send message...") {
                    $(this).val("");
                }
            });
            $("#sendmessage input").focusout(function () {
                if ($(this).val() == "") {
                    $(this).val("Send message...");

                }
            });


            $(".friend").each(function () {
                $(this).click(function () {
                    var childOffset = $(this).offset();
                    var parentOffset = $(this).parent().parent().offset();
                    var childTop = childOffset.top - parentOffset.top;
                    var clone = $(this).find('img').eq(0).clone();
                    var top = childTop + 12 + "px";

                    $(clone).css({ 'top': top }).addClass("floatingImg").appendTo("#chatbox");

                    setTimeout(function () { $("#profile p").addClass("animate"); $("#profile").addClass("animate"); }, 100);
                    setTimeout(function () {
                        $("#chat-messages").addClass("animate");
                        $('.cx, .cy').addClass('s1');
                        setTimeout(function () { $('.cx, .cy').addClass('s2'); }, 100);
                        setTimeout(function () { $('.cx, .cy').addClass('s3'); }, 200);
                    }, 150);

                    $('.floatingImg').animate({
                        'width': "68px",
                        'left': '265px',
                        'top': '20px'
                    }, 300);

                    var name = $(this).find("p strong").html();
                    var email = $(this).find("p span").html();
                    $("#profile p").html(name);
                    $("#profile span").html(email);

                    $(".message").not(".right").find("img").attr("src", $(clone).attr("src"));
                    $('#friendslist').fadeOut();
                    $('#chatview').fadeIn();


                    $('#close').unbind("click").click(function () {
                        $("#chat-messages, #profile, #profile p").removeClass("animate");
                        $('.cx, .cy').removeClass("s1 s2 s3");
                        $('.floatingImg').animate({
                            'width': "40px",
                            'top': top,
                            'left': '12px'
                        }, 200, function () { $('.floatingImg').remove() });

                        setTimeout(function () {
                            $('#chatview').fadeOut();
                            $('#friendslist').fadeIn();
                        }, 50);
                    });

                });
            });
        });</script>
</head>

<body style="background-color: rgb(200, 200, 200);">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" style="background-color: rgba(0, 0, 0, 98);">
        <div class="container">
            <img src="./images/LOGO.png" style="width: 40px; height: 40px;">
            <a class="navbar-brand" href="#">&nbsp다 ~ 주라</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">My Page</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Chatting</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="chatbox" style="margin-top:100px;">
        <div id="friendslist">
            <div id="topmenu">
                <span class="friends"></span>
                <span class="chats"></span>
                <span class="history"></span>
            </div>

            <div id="friends">
                <div class="friend">
                    <img src="images/user.png" />
                    <p>
                        <strong>대화상대 이름1</strong>
                        <span>대화상대 이메일</span>
                    </p>
                </div>

                <div class="friend">
                    <img src="images/user.png" />
                    <p>
                        <strong>대화상대 이름2</strong>
                        <span>대화상대 이메일2</span>
                    </p>
                </div>

                <div class="friend">
                    <img src="images/user.png" />
                    <p>
                        <strong>Tomas Kennedy</strong>
                        <span>tomaskennedy@gmail.com</span>
                    </p>
                </div>

                <div class="friend">
                    <img src="images/user.png" />
                    <p>
                        <strong>Enrique Sutton</strong>
                        <span>enriquesutton@gmail.com</span>
                    </p>
                </div>

                <div class="friend">
                    <img src="images/user.png" />
                    <p>
                        <strong> Darnell Strickland</strong>
                        <span>darnellstrickland@gmail.com</span>
                    </p>
                </div>

                <div id="search">
                    <input type="text" id="searchfield" value="Search contacts..." />
                </div>

            </div>

        </div>

        <div id="chatview" class="p1">
            <div id="profile">

                <div id="close">
                    <div class="cy"></div>
                    <div class="cx"></div>
                </div>

                <p>대화상대 이름</p>
                <span>대화상대 이메일</span>
            </div>
            <div id="chat-messages">
                <label>Thursday 02</label>

                <div class="message">
                    <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/245657/1_copy.jpg" />
                    <div class="bubble">
                        내 메시지
                        <div class="corner"></div>
                        <span>경과 시간</span>
                    </div>
                </div>

                <div class="message right">
                    <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/245657/2_copy.jpg" />
                    <div class="bubble">
                        상대 메시지
                        <div class="corner"></div>
                        <span>경과 시간</span>
                    </div>
                </div>
            </div>

            <div id="sendmessage">
                <input type="text" value="Send message..." />
                <button id="send"></button>
            </div>

        </div>
    </div>


</body>

</html>